<!-- âœ… Moneywala RD (Recurring Deposit) Calculator -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div id="rd-calculator" class="max-w-4xl mx-auto my-10 bg-white shadow-2xl rounded-2xl p-6 font-sans">
  <!-- Heading -->
  <div class="bg-green-600 rounded-2xl p-4 text-center">
    <h1 class="text-white text-2xl font-bold">ðŸ’° Moneywala RD Calculator</h1>
  </div>
  <p class="text-gray-700 text-center mt-2 mb-6">
    Calculate returns for a Recurring Deposit (monthly deposits). Supports years + months tenure, selectable compounding frequency, and optional inflation adjustment.
  </p>

  <!-- Inputs -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div>
      <label class="block text-gray-700 font-medium">Monthly Deposit Amount</label>
      <input type="number" id="rd-amount" class="w-full p-2 border rounded" value="5000" min="0" />
    </div>

    <div>
      <label class="block text-gray-700 font-medium">Tenure - Years</label>
      <input type="number" id="rd-years" class="w-full p-2 border rounded" value="5" min="0" />
    </div>

    <div>
      <label class="block text-gray-700 font-medium">Tenure - Months</label>
      <input type="number" id="rd-months" class="w-full p-2 border rounded" value="0" min="0" max="11" />
    </div>

    <div>
      <label class="block text-gray-700 font-medium">Annual Interest Rate (%)</label>
      <input type="number" id="rd-rate" class="w-full p-2 border rounded" value="7" step="0.01" min="0" />
    </div>

    <div>
      <label class="block text-gray-700 font-medium">Compounding Frequency</label>
      <select id="rd-frequency" class="w-full p-2 border rounded">
        <option value="12">Monthly</option>
        <option value="4">Quarterly</option>
        <option value="2">Half-Yearly</option>
        <option value="1">Yearly</option>
      </select>
    </div>

    <div>
      <label class="block text-gray-700 font-medium">Currency</label>
      <select id="rd-currency" class="w-full p-2 border rounded">
        <option value="â‚¹">â‚¹</option>
        <option value="$">$</option>
        <option value="â‚¬">â‚¬</option>
        <option value="Â£">Â£</option>
      </select>
    </div>

    <div class="flex items-center mt-6">
      <input type="checkbox" id="rd-inflation-check" class="mr-2" />
      <label class="text-gray-700 font-medium">Adjust for Inflation</label>
    </div>

    <div id="rd-inflation-container" class="hidden">
      <label class="block text-gray-700 font-medium">Inflation Rate (%)</label>
      <input type="number" id="rd-inflation-rate" class="w-full p-2 border rounded" value="5" step="0.01" min="0" />
    </div>
  </div>

  <!-- Buttons -->
  <div class="flex justify-center gap-4 mb-6">
    <button id="rd-calc" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">Calculate</button>
    <button id="rd-reset" class="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500">Reset</button>
  </div>

  <!-- Results -->
  <div id="rd-results" class="text-center mb-6 hidden">
    <h2 class="text-xl font-bold mb-2">Results</h2>
    <p id="rd-total-deposited" class="text-gray-700 mb-1"></p>
    <p id="rd-interest-earned" class="text-gray-700 mb-1"></p>
    <p id="rd-maturity-value" class="text-gray-700 mb-1"></p>
    <p id="rd-real-value" class="text-gray-700 mb-1"></p>
  </div>

  <!-- Charts -->
  <div class="mb-6">
    <canvas id="rd-barChart"></canvas>
  </div>
  <div class="mb-6">
    <canvas id="rd-pieChart" style="max-height:400px;"></canvas>
  </div>

  <!-- Yearly Breakdown Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-300" id="rd-breakdown">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 border">Period</th>
          <th class="px-4 py-2 border">Total Deposited</th>
          <th class="px-4 py-2 border">Interest Earned</th>
          <th class="px-4 py-2 border">Total Value</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // Elements
  const amtEl = document.getElementById('rd-amount');
  const yearsEl = document.getElementById('rd-years');
  const monthsEl = document.getElementById('rd-months');
  const rateEl = document.getElementById('rd-rate');
  const freqEl = document.getElementById('rd-frequency');
  const currencyEl = document.getElementById('rd-currency');
  const inflationCheck = document.getElementById('rd-inflation-check');
  const inflationContainer = document.getElementById('rd-inflation-container');
  const inflationRateEl = document.getElementById('rd-inflation-rate');

  const calcBtn = document.getElementById('rd-calc');
  const resetBtn = document.getElementById('rd-reset');

  const resultsBlock = document.getElementById('rd-results');
  const totalDepositedEl = document.getElementById('rd-total-deposited');
  const interestEl = document.getElementById('rd-interest-earned');
  const maturityEl = document.getElementById('rd-maturity-value');
  const realEl = document.getElementById('rd-real-value');

  const breakdownBody = document.querySelector('#rd-breakdown tbody');

  let barChart = null;
  let pieChart = null;

  inflationCheck.addEventListener('change', () => {
    inflationContainer.classList.toggle('hidden', !inflationCheck.checked);
  });

  function toNumber(v){ const n = parseFloat(v); return isNaN(n) ? 0 : n; }

  calcBtn.addEventListener('click', () => {
    // Read inputs
    const P = Math.max(0, toNumber(amtEl.value)); // monthly deposit
    const years = Math.max(0, Math.floor(toNumber(yearsEl.value)));
    const months = Math.min(11, Math.max(0, Math.floor(toNumber(monthsEl.value))));
    const totalMonths = years*12 + months;
    const tYears = totalMonths / 12;
    const annualRate = Math.max(0, toNumber(rateEl.value)) / 100;
    const n = parseInt(freqEl.value, 10); // compounding per year
    const currency = currencyEl.value;
    const inflation = inflationCheck.checked ? Math.max(0, toNumber(inflationRateEl.value)/100) : 0;

    // Validate
    if(P <= 0 || totalMonths <= 0){
      alert('Please enter a positive monthly deposit and tenure.');
      return;
    }

    breakdownBody.innerHTML = '';

    // Convert compounding to equivalent monthly rate (monthlyFactor) consistent with chosen n
    // monthlyFactor i such that (1+i)^12 = (1 + r/n)^(n)
    let monthlyFactor;
    if(annualRate === 0){
      monthlyFactor = 0;
    } else {
      monthlyFactor = Math.pow(Math.pow(1 + annualRate / n, n), 1/12) - 1;
    }

    // RD FV calculation using monthlyFactor
    // N = totalMonths, i = monthlyFactor
    const N = totalMonths;
    let fv;
    if(monthlyFactor === 0){
      fv = P * N;
    } else {
      fv = P * (Math.pow(1 + monthlyFactor, N) - 1) / monthlyFactor;
    }

    // Build yearly breakdown by simulating month-by-month (accurate)
    const rows = [];
    let balance = 0;
    let depositedCumulative = 0;
    for(let m = 1; m <= N; m++){
      // deposit at month-end convention
      depositedCumulative += P;
      balance = balance * (1 + monthlyFactor) + P;
      if(m % 12 === 0){
        const yearIndex = m / 12;
        rows.push({
          label: `Year ${yearIndex}`,
          deposited: depositedCumulative,
          interest: Math.max(0, balance - depositedCumulative),
          value: balance
        });
      }
    }
    const leftoverMonths = N % 12;
    if(leftoverMonths !== 0){
      // If no full years (N < 12) or there's a final partial year, push final partial row
      rows.push({
        label: `${Math.floor(N/12)}yr + ${leftoverMonths}mo`,
        deposited: depositedCumulative,
        interest: Math.max(0, balance - depositedCumulative),
        value: balance
      });
    }

    // Totals
    const invested = P * N;
    let nominalFV = fv;
    let nominalInterest = Math.max(0, nominalFV - invested); // clamp to >=0 for UI sanity (inflation not applied)
    if(!inflation && nominalInterest < 0) nominalInterest = 0;

    let realFV = null;
    if(inflation){
      realFV = nominalFV / Math.pow(1 + inflation, tYears);
    }

    // Populate results
    totalDepositedEl.textContent = `Total Deposited: ${currency}${invested.toLocaleString(undefined,{maximumFractionDigits:2})}`;
    interestEl.textContent = `Estimated Interest (Nominal): ${currency}${nominalInterest.toLocaleString(undefined,{maximumFractionDigits:2})}`;
    maturityEl.textContent = `Maturity Value (Nominal): ${currency}${nominalFV.toLocaleString(undefined,{maximumFractionDigits:2})}`;
    if(inflation){
      realEl.textContent = `Real Value after inflation (${(inflation*100).toFixed(2)}%): ${currency}${realFV.toLocaleString(undefined,{maximumFractionDigits:2})}`;
      realEl.classList.remove('hidden');
    } else {
      realEl.textContent = '';
      realEl.classList.add('hidden');
    }
    resultsBlock.classList.remove('hidden');

    // Populate table
    breakdownBody.innerHTML = '';
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="px-4 py-2 border">${r.label}</td>
        <td class="px-4 py-2 border">${currency}${r.deposited.toLocaleString(undefined,{maximumFractionDigits:2})}</td>
        <td class="px-4 py-2 border">${currency}${r.interest.toLocaleString(undefined,{maximumFractionDigits:2})}</td>
        <td class="px-4 py-2 border">${currency}${r.value.toLocaleString(undefined,{maximumFractionDigits:2})}</td>
      `;
      breakdownBody.appendChild(tr);
    });

    // Charts
    const labels = rows.map(r=>r.label);
    const values = rows.map(r=>r.value);
    const principalForPie = invested;
    const returnsForPie = Math.max(0, nominalFV - invested);

    if(barChart) barChart.destroy();
    if(pieChart) pieChart.destroy();

    const ctxBar = document.getElementById('rd-barChart').getContext('2d');
    barChart = new Chart(ctxBar, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Total Value',
          data: values,
          backgroundColor: 'rgba(34,197,94,0.7)',
          borderColor: 'rgba(34,197,94,1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });

    const ctxPie = document.getElementById('rd-pieChart').getContext('2d');
    pieChart = new Chart(ctxPie, {
      type: 'pie',
      data: {
        labels: ['Principal','Interest'],
        datasets: [{ data: [principalForPie, returnsForPie], backgroundColor: ['#10B981','#6366F1'] }]
      },
      options: { responsive: true }
    });
  });

  // Reset
  resetBtn.addEventListener('click', ()=>{
    amtEl.value = 5000;
    yearsEl.value = 5;
    monthsEl.value = 0;
    rateEl.value = 7;
    freqEl.value = 12;
    currencyEl.value = 'â‚¹';
    inflationCheck.checked = false;
    inflationContainer.classList.add('hidden');
    inflationRateEl.value = 5;
    resultsBlock.classList.add('hidden');
    breakdownBody.innerHTML = '';
    totalDepositedEl.textContent = '';
    interestEl.textContent = '';
    maturityEl.textContent = '';
    realEl.textContent = '';
    if(barChart){ barChart.destroy(); barChart = null; }
    if(pieChart){ pieChart.destroy(); pieChart = null; }
  });
});
</script>